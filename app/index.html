<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' https:; style-src 'self' 'unsafe-inline';">
  <title>Worklist v1.1.0 ‚Äî Offline-First Task Management</title>
  <script src="./react.production.min.js"></script>
  <script src="./react-dom.production.min.js"></script>
  <script src="./babel.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');
    
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body, #root { height: 100%; }
    body { 
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif; 
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      line-height: 1.5;
      font-size: 15px;
    }
    
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: var(--scrollbar-track); }
    ::-webkit-scrollbar-thumb { background: var(--scrollbar-thumb); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--scrollbar-hover); }
    .drag-over { background-color: #3b82f6 !important; opacity: 0.7; }

    /* Warm Light Theme - Easy on the eyes */
    :root {
      --bg-primary: #faf8f5;
      --bg-secondary: #fffef9;
      --bg-sidebar: #3d3026;
      --bg-sidebar-hover: #4a3a2e;
      --bg-sidebar-active: #8b6f47;
      --bg-input: #fffef9;
      --bg-table-header: #f5f2ed;
      --bg-table-row-hover: #f9f6f1;
      --bg-expanded: #faf8f5;
      --bg-modal: #fffef9;
      --bg-modal-overlay: rgba(61, 48, 38, 0.5);
      --bg-badge: #f5f2ed;
      --bg-undo: #3d3026;
      
      --text-primary: #3d3026;
      --text-secondary: #5d4a3a;
      --text-muted: #8b7355;
      --text-placeholder: #a89582;
      --text-sidebar: #e8dcc8;
      --text-sidebar-muted: #a89582;
      --text-inverse: #fffef9;
      
      --border-primary: #e8dcc8;
      --border-light: #f0e6d6;
      
      --scrollbar-track: #f5f2ed;
      --scrollbar-thumb: #c9b89a;
      --scrollbar-hover: #a89582;
      
      --status-pending-bg: #f5f2ed;
      --status-pending-text: #5d4a3a;
      --status-pending-border: #e8dcc8;
      --status-active-bg: #dbeafe;
      --status-active-text: #0369a1;
      --status-active-border: #7dd3fc;
      --status-done-bg: #d1fae5;
      --status-done-text: #065f46;
      --status-done-border: #6ee7b7;
      
      --section-done-bg: #f0fdf4;
      --section-done-border: #a7f3d0;
      --section-done-header: #d1fae5;
      
      --priority-high-bg: #fef2f2;
      --priority-high-border: #fca5a5;
      --priority-high-header: #fee2e2;
      --priority-medium-bg: #fef9e7;
      --priority-medium-border: #fde68a;
      --priority-medium-header: #fef3c7;
      --priority-low-bg: #f5f2ed;
      --priority-low-border: #e8dcc8;
      --priority-low-header: #f0e6d6;
      
      --alert-overdue: #fee2e2;
      --alert-overdue-border: #ef4444;
      --alert-today: #fef9e7;
      --alert-today-border: #f59e0b;
      --alert-soon: #fff7ed;
      --alert-soon-border: #fb923c;
    }

    /* Dark Theme */
    [data-theme="dark"] {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-sidebar: #0f172a;
      --bg-sidebar-hover: #1e293b;
      --bg-sidebar-active: #2563eb;
      --bg-input: #1e293b;
      --bg-table-header: #1e293b;
      --bg-table-row-hover: #334155;
      --bg-expanded: #1e293b;
      --bg-modal: #1e293b;
      --bg-modal-overlay: rgba(0, 0, 0, 0.7);
      --bg-badge: #334155;
      --bg-undo: #334155;
      
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --text-muted: #94a3b8;
      --text-placeholder: #64748b;
      --text-sidebar: #e2e8f0;
      --text-sidebar-muted: #94a3b8;
      --text-inverse: #0f172a;
      
      --border-primary: #334155;
      --border-light: #1e293b;
      
      --scrollbar-track: #1e293b;
      --scrollbar-thumb: #475569;
      --scrollbar-hover: #64748b;
      
      --status-pending-bg: #334155;
      --status-pending-text: #e2e8f0;
      --status-pending-border: #475569;
      --status-active-bg: #1e3a5f;
      --status-active-text: #93c5fd;
      --status-active-border: #2563eb;
      --status-done-bg: #14532d;
      --status-done-text: #a7f3d0;
      --status-done-border: #22c55e;
      
      --section-done-bg: #14532d20;
      --section-done-border: #22c55e40;
      --section-done-header: #14532d40;
      
      --priority-high-bg: #7c2d1220;
      --priority-high-border: #f9731640;
      --priority-high-header: #7c2d1240;
      --priority-medium-bg: #78350f20;
      --priority-medium-border: #f59e0b40;
      --priority-medium-header: #78350f40;
      --priority-low-bg: #1e293b;
      --priority-low-border: #334155;
      --priority-low-header: #334155;
      
      --alert-overdue: #7f1d1d;
      --alert-overdue-border: #ef4444;
      --alert-today: #78350f;
      --alert-today-border: #f59e0b;
      --alert-soon: #7c2d12;
      --alert-soon-border: #fb923c;
    }

    .app-container { display: flex; height: 100vh; background: var(--bg-primary); }
    
    .sidebar { width: 220px; background: var(--bg-sidebar); display: flex; flex-direction: column; }
    .sidebar-header { padding: 16px; display: flex; align-items: center; gap: 10px; }
    .sidebar-header span { font-weight: 600; color: var(--text-inverse); letter-spacing: -0.025em; font-size: 16px; }
    .sidebar-content { flex: 1; overflow-y: auto; padding: 4px 8px; }
    .sidebar-section-title { font-size: 11px; font-weight: 600; color: var(--text-sidebar-muted); text-transform: uppercase; letter-spacing: 0.05em; padding: 12px 8px 8px; }
    
    .tab-item { display: flex; align-items: center; justify-content: space-between; padding: 8px 10px; border-radius: 6px; cursor: pointer; margin-bottom: 2px; transition: all 0.15s; }
    .tab-item:hover { background: var(--bg-sidebar-hover); }
    .tab-item.active { background: var(--bg-sidebar-active); }
    .tab-item .tab-name { font-size: 14px; color: var(--text-sidebar); display: flex; align-items: center; gap: 6px; }
    .tab-item.active .tab-name { color: var(--text-inverse); font-weight: 500; }
    .tab-item .tab-count { font-family: 'SF Mono', Consolas, monospace; font-size: 12px; color: var(--text-sidebar-muted); background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; }
    .tab-item.active .tab-count { color: rgba(255,255,255,0.8); background: rgba(255,255,255,0.2); }
    .tab-item .tab-close { padding: 4px; border-radius: 4px; opacity: 0; transition: all 0.15s; color: var(--text-sidebar-muted); background: none; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .tab-item:hover .tab-close { opacity: 1; }
    .tab-item .tab-close:hover { background: rgba(255,255,255,0.1); color: var(--text-inverse); }
    .tab-item .grip { color: var(--text-sidebar-muted); cursor: grab; opacity: 0; transition: opacity 0.15s; }
    .tab-item:hover .grip { opacity: 1; }

    .add-category { display: flex; align-items: center; gap: 6px; padding: 8px 10px; font-size: 14px; color: var(--text-sidebar-muted); cursor: pointer; border-radius: 6px; transition: all 0.15s; background: none; border: none; width: 100%; text-align: left; margin-top: 4px; }
    .add-category:hover { color: var(--text-sidebar); background: var(--bg-sidebar-hover); }

    .priority-tab { display: flex; align-items: center; gap: 8px; padding: 8px 10px; border-radius: 6px; cursor: pointer; transition: all 0.15s; color: var(--text-sidebar); font-size: 14px; }
    .priority-tab:hover { background: var(--bg-sidebar-hover); }
    .priority-tab.active { background: #f59e0b; color: var(--text-inverse); font-weight: 500; }

    .sidebar-footer { padding: 12px; border-top: 1px solid rgba(255,255,255,0.1); }
    .sync-status { display: flex; align-items: center; gap: 6px; font-size: 11px; color: var(--text-sidebar-muted); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.05em; }
    .sync-dot { width: 8px; height: 8px; border-radius: 50%; }
    .sync-dot.saving { background: #fbbf24; animation: pulse 2s infinite; }
    .sync-dot.saved { background: #22c55e; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

    .sidebar-buttons { display: flex; gap: 6px; margin-bottom: 8px; }
    .sidebar-btn { flex: 1; display: flex; align-items: center; justify-content: center; gap: 4px; padding: 8px; font-size: 12px; background: rgba(255,255,255,0.1); color: var(--text-sidebar); border: none; border-radius: 6px; cursor: pointer; transition: all 0.15s; font-weight: 500; }
    .sidebar-btn:hover { background: rgba(255,255,255,0.15); color: var(--text-inverse); }
    .sidebar-btn.full { width: 100%; }
    
    .theme-toggle { display: flex; align-items: center; justify-content: center; gap: 6px; padding: 8px; font-size: 12px; background: rgba(255,255,255,0.05); color: var(--text-sidebar-muted); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; cursor: pointer; transition: all 0.15s; width: 100%; margin-top: 8px; }
    .theme-toggle:hover { background: rgba(255,255,255,0.1); color: var(--text-sidebar); border-color: rgba(255,255,255,0.2); }

    .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
    .main-header { background: var(--bg-secondary); border-bottom: 1px solid var(--border-primary); padding: 16px 24px; display: flex; align-items: center; justify-content: space-between; }
    .main-header h1 { font-size: 20px; font-weight: 600; color: var(--text-primary); }
    .header-buttons { display: flex; gap: 8px; }
    
    .btn { display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; font-size: 14px; border-radius: 6px; cursor: pointer; transition: all 0.15s; border: none; font-weight: 500; }
    .btn-primary { background: #2563eb; color: white; }
    .btn-primary:hover { background: #1d4ed8; }
    .btn-secondary { background: var(--bg-badge); color: var(--text-secondary); border: 1px solid var(--border-primary); }
    .btn-secondary:hover { background: var(--border-primary); }
    .btn-danger { background: #ef4444; color: white; }
    .btn-danger:hover { background: #dc2626; }

    .main-body { flex: 1; overflow: auto; padding: 24px; }

    .task-section { background: var(--bg-secondary); border: 1px solid var(--border-primary); border-radius: 8px; margin-bottom: 16px; overflow: hidden; }
    .task-section.done { background: var(--section-done-bg); border-color: var(--section-done-border); }
    .section-header { padding: 12px 16px; border-bottom: 1px solid var(--border-primary); background: var(--bg-table-header); display: flex; align-items: center; justify-content: space-between; }
    .task-section.done .section-header { background: var(--section-done-header); border-color: var(--section-done-border); }
    .section-title { font-size: 14px; font-weight: 600; color: var(--text-primary); }
    .section-count { font-family: 'SF Mono', Consolas, monospace; font-size: 12px; color: var(--text-muted); background: var(--bg-badge); padding: 2px 8px; border-radius: 4px; }

    .task-table { width: 100%; border-collapse: collapse; }
    .task-table th { text-align: left; padding: 10px 12px; font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid var(--border-primary); background: var(--bg-table-header); }
    .task-section.done .task-table th { background: var(--section-done-header); border-color: var(--section-done-border); }
    .task-table td { padding: 10px 12px; border-bottom: 1px solid var(--border-primary); vertical-align: middle; }
    .task-section.done .task-table td { border-color: var(--section-done-border); }
    .task-row { transition: background-color 0.15s; }
    .task-row:hover { background: var(--bg-table-row-hover); }
    
    /* Status-based row colors */
    .task-row.status-pending { background: var(--status-pending-bg); border-left: 3px solid var(--status-pending-border); }
    .task-row.status-in-progress { background: var(--status-active-bg); border-left: 3px solid var(--status-active-border); }
    .task-row.status-done { background: var(--section-done-bg); border-left: 3px solid var(--section-done-border); opacity: 0.9; }
    
    .task-row.focused { outline: 2px solid var(--bg-sidebar-active); outline-offset: -2px; }

    .due-badge { display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: 600; margin-left: 8px; }
    .due-badge.overdue { background: var(--alert-overdue); color: #dc2626; border: 1px solid var(--alert-overdue-border); }
    .due-badge.today { background: var(--alert-today); color: #d97706; border: 1px solid var(--alert-today-border); }
    .due-badge.soon { background: var(--alert-soon); color: #ea580c; border: 1px solid var(--alert-soon-border); }
    .due-badge.today { background: var(--alert-today); color: #d97706; border: 1px solid var(--alert-today-border); }
    .due-badge.soon { background: var(--alert-soon); color: #ea580c; border: 1px solid var(--alert-soon-border); }

    .expand-btn { padding: 6px; background: none; border: none; cursor: pointer; color: var(--text-muted); border-radius: 4px; transition: all 0.15s; display: flex; align-items: center; justify-content: center; }
    .expand-btn:hover { background: var(--bg-badge); color: var(--text-primary); }

    .task-input { flex: 1; background: transparent; border: none; outline: none; font-size: 15px; color: var(--text-primary); }
    .task-input::placeholder { color: var(--text-placeholder); }
    .task-input.done { text-decoration: line-through; color: var(--text-muted); }

    .task-title-cell { display: flex; align-items: center; gap: 8px; }
    .subtask-badge { font-family: 'SF Mono', Consolas, monospace; font-size: 12px; color: var(--text-muted); background: var(--bg-badge); padding: 3px 8px; border-radius: 4px; }

    .status-select { font-size: 14px; padding: 8px 12px; border-radius: 6px; border: 1px solid; outline: none; cursor: pointer; font-weight: 500; min-height: 38px; }
    .status-pending { background: var(--status-pending-bg); color: var(--status-pending-text); border-color: var(--status-pending-border); }
    .status-in-progress { background: var(--status-active-bg); color: var(--status-active-text); border-color: var(--status-active-border); }
    .status-done { background: var(--status-done-bg); color: var(--status-done-text); border-color: var(--status-done-border); }

    .priority-cell { display: flex; align-items: center; gap: 6px; }
    .priority-dot { width: 12px; height: 12px; border-radius: 50%; }
    .priority-dot.low { background: #94a3b8; }
    .priority-dot.medium { background: #f59e0b; }
    .priority-dot.high { background: #f97316; }
    .priority-select { font-size: 14px; padding: 8px 12px; border-radius: 6px; border: 1px solid var(--border-primary); background: var(--bg-input); color: var(--text-primary); outline: none; cursor: pointer; min-height: 38px; }

    .date-input { font-family: 'SF Mono', Consolas, monospace; font-size: 14px; padding: 6px 8px; background: transparent; border: none; outline: none; color: var(--text-secondary); min-height: 38px; cursor: pointer; }
    .date-input::-webkit-calendar-picker-indicator { cursor: pointer; opacity: 0.7; width: 20px; height: 20px; }
    .date-input::-webkit-calendar-picker-indicator:hover { opacity: 1; }
    [data-theme="dark"] .date-input::-webkit-calendar-picker-indicator { filter: invert(1); }

    .delete-btn { padding: 6px; background: none; border: none; cursor: pointer; color: var(--text-placeholder); border-radius: 4px; opacity: 0; transition: all 0.15s; display: flex; align-items: center; justify-content: center; }
    .task-row:hover .delete-btn { opacity: 1; }
    .delete-btn:hover { color: #ef4444; background: #fef2f2; }
    [data-theme="dark"] .delete-btn:hover { background: #7f1d1d30; }

    .expanded-row { background: var(--bg-expanded); }
    .expanded-row td { padding: 16px; }
    .expanded-content { padding-left: 8px; }

    .subtask-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
    .add-subtask-btn { display: inline-flex; align-items: center; gap: 4px; font-size: 13px; color: #2563eb; background: none; border: none; cursor: pointer; font-weight: 500; padding: 4px 8px; border-radius: 4px; transition: all 0.15s; }
    .add-subtask-btn:hover { background: #2563eb15; }
    .subtask-label { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; font-weight: 600; }

    .subtask-list { display: flex; flex-direction: column; gap: 4px; }
    .subtask-item { display: flex; align-items: center; gap: 10px; padding: 10px 12px; margin: 0 -12px; border-radius: 6px; transition: background-color 0.15s; }
    .subtask-item:hover { background: var(--bg-badge); }
    .subtask-checkbox { width: 18px; height: 18px; cursor: pointer; accent-color: #2563eb; }
    .subtask-input { flex: 1; background: transparent; border: none; outline: none; font-size: 15px; color: var(--text-secondary); }
    .subtask-input::placeholder { color: var(--text-placeholder); }
    .subtask-input.done { text-decoration: line-through; color: var(--text-muted); }
    .subtask-delete { padding: 4px; background: none; border: none; cursor: pointer; color: var(--text-placeholder); opacity: 0; transition: all 0.15s; display: flex; align-items: center; justify-content: center; border-radius: 4px; }
    .subtask-item:hover .subtask-delete { opacity: 1; }
    .subtask-delete:hover { color: #ef4444; background: #fef2f220; }

    .notes-label { font-size: 12px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin: 16px 0 8px; font-weight: 600; }
    .notes-input { width: 100%; padding: 12px 14px; font-size: 15px; line-height: 1.6; border: 1px solid var(--border-primary); border-radius: 6px; resize: none; outline: none; color: var(--text-secondary); background: var(--bg-input); }
    .notes-input::placeholder { color: var(--text-placeholder); }
    .notes-input:focus { border-color: #8b6f47; box-shadow: 0 0 0 3px rgba(139, 111, 71, 0.15); }
    [data-theme="dark"] .notes-input:focus { border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15); }

    .empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 64px 20px; text-align: center; }
    .empty-icon { width: 80px; height: 80px; background: var(--bg-badge); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; }
    .empty-text { color: var(--text-muted); font-size: 15px; margin-bottom: 20px; }
    .no-subtasks { font-size: 14px; color: var(--text-placeholder); font-style: italic; padding: 8px 0; }

    .priority-section { background: var(--bg-secondary); border: 1px solid var(--border-primary); border-radius: 8px; margin-bottom: 16px; overflow: hidden; }
    .priority-section.high { border-color: var(--priority-high-border); background: var(--priority-high-bg); }
    .priority-section.medium { border-color: var(--priority-medium-border); background: var(--priority-medium-bg); }
    .priority-section.low { border-color: var(--priority-low-border); background: var(--priority-low-bg); }
    .priority-section.complete { border-color: var(--section-done-border); background: var(--section-done-bg); }
    .priority-section.high .section-header { background: var(--priority-high-header); border-color: var(--priority-high-border); }
    .priority-section.medium .section-header { background: var(--priority-medium-header); border-color: var(--priority-medium-border); }
    .priority-section.low .section-header { background: var(--priority-low-header); border-color: var(--priority-low-border); }
    .priority-section.complete .section-header { background: var(--section-done-header); border-color: var(--section-done-border); }
    .priority-section .task-table th { background: transparent; }

    .category-badge { font-family: 'SF Mono', Consolas, monospace; font-size: 11px; padding: 3px 8px; background: var(--bg-badge); color: var(--text-secondary); border-radius: 4px; }

    .modal-overlay { position: fixed; inset: 0; background: var(--bg-modal-overlay); z-index: 40; display: flex; align-items: center; justify-content: center; padding: 16px; }
    .modal { background: var(--bg-modal); border-radius: 12px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); max-width: 420px; width: 100%; padding: 24px; border: 1px solid var(--border-primary); }
    .modal-title { font-size: 18px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
    .modal-text { font-size: 14px; color: var(--text-muted); margin-bottom: 20px; line-height: 1.5; }
    .modal-buttons { display: flex; gap: 10px; }
    .modal-buttons .btn { flex: 1; justify-content: center; }

    .modal-input { width: 100%; padding: 10px 12px; font-size: 14px; border: 1px solid var(--border-primary); border-radius: 6px; outline: none; margin-bottom: 16px; background: var(--bg-input); color: var(--text-primary); }
    .modal-input:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15); }
    .modal-input::placeholder { color: var(--text-placeholder); }

    .modal-label { font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 6px; display: block; }
    .modal-help { background: var(--bg-badge); border-radius: 8px; padding: 14px; margin-bottom: 16px; }
    .modal-help-title { font-size: 13px; font-weight: 600; color: var(--text-primary); margin-bottom: 10px; }
    .modal-help ol { font-size: 13px; color: var(--text-secondary); padding-left: 18px; line-height: 1.6; }
    .modal-help li { margin-bottom: 4px; }

    .checkbox-label { display: flex; align-items: center; gap: 10px; font-size: 14px; color: var(--text-secondary); margin-bottom: 16px; cursor: pointer; }
    .checkbox-label input { width: 18px; height: 18px; accent-color: #2563eb; }

    .alert { padding: 10px 14px; border-radius: 6px; font-size: 14px; margin-bottom: 16px; }
    .alert-error { background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; }
    .alert-success { background: #f0fdf4; color: #16a34a; border: 1px solid #bbf7d0; }
    [data-theme="dark"] .alert-error { background: #7f1d1d30; border-color: #7f1d1d; }
    [data-theme="dark"] .alert-success { background: #14532d30; border-color: #14532d; }

    .undo-toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); z-index: 50; background: var(--bg-undo); color: var(--text-inverse); padding: 12px 16px; border-radius: 10px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); display: flex; align-items: center; gap: 16px; }
    .undo-toast span { font-size: 14px; }
    .undo-btn { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; background: #2563eb; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; transition: background-color 0.15s; }
    .undo-btn:hover { background: #1d4ed8; }
    .undo-close { padding: 6px; background: none; border: none; cursor: pointer; color: var(--text-muted); display: flex; align-items: center; justify-content: center; border-radius: 4px; transition: all 0.15s; }
    .undo-close:hover { color: var(--text-inverse); background: rgba(255,255,255,0.1); }

    .tab-input { flex: 1; padding: 4px 8px; font-size: 14px; background: #0f172a; border: 2px solid #3b82f6; border-radius: 4px; outline: none; color: white; }

    .hidden { display: none; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const STORAGE_KEY = 'worklistData';
    const SETTINGS_KEY = 'worklistSettings';

    const defaultData = { tabs: ['Tasks'], tasks: { 'Tasks': [] } };
    const defaultSettings = { slackWebhook: '', theme: 'light' };

    const loadSavedData = () => {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
          const data = JSON.parse(saved);
          if (data.tabs && data.tasks) return data;
        }
      } catch (e) {}
      return defaultData;
    };

    const loadSettings = () => {
      try {
        const saved = localStorage.getItem(SETTINGS_KEY);
        if (saved) return { ...defaultSettings, ...JSON.parse(saved) };
      } catch (e) {}
      return defaultSettings;
    };

    // Icons
    const ChevronRight = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><polyline points="9 18 15 12 9 6"/></svg>;
    const ChevronDown = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><polyline points="6 9 12 15 18 9"/></svg>;
    const Plus = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>;
    const X = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
    const Download = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>;
    const Upload = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>;
    const SlackIcon = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528 0 0 1-2.521-2.52A2.528 2.528 0 0 1 8.834 0a2.528 2.528 0 0 1 2.521 2.522v2.52H8.834zM8.834 6.313a2.528 2.528 0 0 1 2.521 2.521 2.528 2.528 0 0 1-2.521 2.521H2.522A2.528 2.528 0 0 1 0 8.834a2.528 2.528 0 0 1 2.522-2.521h6.312zM18.956 8.834a2.528 2.528 0 0 1 2.522-2.521A2.528 2.528 0 0 1 24 8.834a2.528 2.528 0 0 1-2.522 2.521h-2.522V8.834zM17.688 8.834a2.528 2.528 0 0 1-2.523 2.521 2.527 2.527 0 0 1-2.52-2.521V2.522A2.527 2.527 0 0 1 15.165 0a2.528 2.528 0 0 1 2.523 2.522v6.312zM15.165 18.956a2.528 2.528 0 0 1 2.523 2.522A2.528 2.528 0 0 1 15.165 24a2.527 2.527 0 0 1-2.52-2.522v-2.522h2.52zM15.165 17.688a2.527 2.527 0 0 1-2.52-2.523 2.526 2.526 0 0 1 2.52-2.52h6.313A2.527 2.527 0 0 1 24 15.165a2.528 2.528 0 0 1-2.522 2.523h-6.313z"/></svg>;
    const UndoIcon = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"/></svg>;
    const GripIcon = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><circle cx="9" cy="5" r="2"/><circle cx="15" cy="5" r="2"/><circle cx="9" cy="12" r="2"/><circle cx="15" cy="12" r="2"/><circle cx="9" cy="19" r="2"/><circle cx="15" cy="19" r="2"/></svg>;
    const ShareIcon = () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M4 12v8a2 2 0 002 2h12a2 2 0 002-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>;
    const SunIcon = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>;
    const MoonIcon = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>;
    const Logo = () => <svg width="32" height="32" viewBox="0 0 32 32" fill="none"><rect x="2" y="2" width="28" height="28" rx="6" fill="#2563eb"/><path d="M8 10h16M8 16h12M8 22h14" stroke="white" strokeWidth="2.5" strokeLinecap="round"/><circle cx="24" cy="22" r="2.5" fill="white"/></svg>;
    const ClipboardIcon = () => <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/><path d="M9 12h6M9 16h6"/></svg>;

    function Worklist() {
      const savedData = loadSavedData();
      const [tabs, setTabs] = useState(savedData.tabs);
      const [activeTab, setActiveTab] = useState(savedData.tabs[0]);
      const [tasks, setTasks] = useState(savedData.tasks);
      const [expandedRows, setExpandedRows] = useState(new Set());
      const [editingTab, setEditingTab] = useState(null);
      const [deletingTab, setDeletingTab] = useState(null);
      const [saveStatus, setSaveStatus] = useState('saved');
      const [settings, setSettings] = useState(loadSettings());
      const [showSlackModal, setShowSlackModal] = useState(false);
      const [focusedTaskIndex, setFocusedTaskIndex] = useState(-1);
      const [showShareModal, setShowShareModal] = useState(false);
      const [shareCategory, setShareCategory] = useState(null);
      const [slackStatus, setSlackStatus] = useState(null);
      const [undoStack, setUndoStack] = useState([]);
      const [showUndo, setShowUndo] = useState(false);
      const [draggedTab, setDraggedTab] = useState(null);
      const fileInputRef = useRef(null);
      const undoTimeoutRef = useRef(null);

      // Apply theme on load and change
      useEffect(() => {
        document.documentElement.setAttribute('data-theme', settings.theme);
      }, [settings.theme]);

      useEffect(() => {
        setSaveStatus('saving');
        const timeout = setTimeout(() => {
          localStorage.setItem(STORAGE_KEY, JSON.stringify({ tabs, tasks }));
          setSaveStatus('saved');
        }, 800);
        return () => clearTimeout(timeout);
      }, [tabs, tasks]);

      useEffect(() => {
        localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
      }, [settings]);

      useEffect(() => {
        if (showUndo) {
          undoTimeoutRef.current = setTimeout(() => { setShowUndo(false); setUndoStack([]); }, 5000);
        }
        return () => clearTimeout(undoTimeoutRef.current);
      }, [showUndo]);

      const toggleTheme = () => {
        setSettings({ ...settings, theme: settings.theme === 'light' ? 'dark' : 'light' });
      };

      // Due date helpers
      const isOverdue = (task) => {
        if (!task.due || task.status === 'done') return false;
        return new Date(task.due) < new Date().setHours(0,0,0,0);
      };

      const isDueToday = (task) => {
        if (!task.due || task.status === 'done') return false;
        const today = new Date().setHours(0,0,0,0);
        const due = new Date(task.due).setHours(0,0,0,0);
        return due === today;
      };

      const isDueSoon = (task) => {
        if (!task.due || task.status === 'done') return false;
        const today = new Date().setHours(0,0,0,0);
        const due = new Date(task.due).setHours(0,0,0,0);
        const threeDays = 3 * 24 * 60 * 60 * 1000;
        return due > today && due <= today + threeDays;
      };

      const getDueDateBadge = (task) => {
        if (isOverdue(task)) return <span className="due-badge overdue">‚ö†Ô∏è Overdue</span>;
        if (isDueToday(task)) return <span className="due-badge today">üìÖ Due Today</span>;
        if (isDueSoon(task)) return <span className="due-badge soon">‚è∞ Due Soon</span>;
        return null;
      };

      const getDueDateClass = (task) => {
        if (isOverdue(task)) return 'overdue';
        if (isDueToday(task)) return 'due-today';
        if (isDueSoon(task)) return 'due-soon';
        return '';
      };

      // Keyboard shortcuts
      useEffect(() => {
        const handleKeyDown = (e) => {
          // Ctrl/Cmd + K: Add task
          if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
            e.preventDefault();
            if (!activeTab.startsWith('‚ö°')) {
              addTask();
            }
          }
          
          // Arrow key navigation
          const currentTasks = tasks[activeTab] || [];
          if (currentTasks.length > 0) {
            if (e.key === 'ArrowDown') {
              e.preventDefault();
              setFocusedTaskIndex(prev => Math.min(prev + 1, currentTasks.length - 1));
            } else if (e.key === 'ArrowUp') {
              e.preventDefault();
              setFocusedTaskIndex(prev => Math.max(prev - 1, 0));
            } else if (e.key === 'Enter' && focusedTaskIndex >= 0) {
              e.preventDefault();
              const task = currentTasks[focusedTaskIndex];
              toggleRow(task.id);
            } else if (e.key === ' ' && focusedTaskIndex >= 0) {
              e.preventDefault();
              const task = currentTasks[focusedTaskIndex];
              updateTask(task.id, 'status', task.status === 'done' ? 'pending' : 'done');
            }
          }
          
          // Escape: Clear focus
          if (e.key === 'Escape') {
            setFocusedTaskIndex(-1);
            setExpandedRows(new Set());
          }
        };

        document.addEventListener('keydown', handleKeyDown);
        return () => document.removeEventListener('keydown', handleKeyDown);
      }, [focusedTaskIndex, activeTab, tasks]);

      // Reset focus when changing tabs
      useEffect(() => {
        setFocusedTaskIndex(-1);
      }, [activeTab]);

      const pushUndo = (action) => { setUndoStack([action]); setShowUndo(true); };

      const performUndo = () => {
        if (undoStack.length === 0) return;
        const action = undoStack[0];
        if (action.type === 'deleteTask') {
          setTasks({ ...tasks, [action.category]: [...(tasks[action.category] || []), action.task] });
        } else if (action.type === 'deleteSubtask') {
          setTasks({ ...tasks, [action.category]: tasks[action.category].map(t => t.id === action.taskId ? { ...t, subtasks: [...(t.subtasks || []), action.subtask] } : t) });
        }
        setShowUndo(false);
        setUndoStack([]);
      };

      const toggleRow = (id) => {
        const newExpanded = new Set(expandedRows);
        newExpanded.has(id) ? newExpanded.delete(id) : newExpanded.add(id);
        setExpandedRows(newExpanded);
      };

      const addTab = () => {
        const name = `Category ${tabs.length + 1}`;
        setTabs([...tabs, name]);
        setTasks({ ...tasks, [name]: [] });
        setActiveTab(name);
      };

      const closeTab = (tab) => {
        if (tabs.length === 1) return;
        const newTabs = tabs.filter(t => t !== tab);
        const newTasks = { ...tasks };
        delete newTasks[tab];
        setTabs(newTabs);
        setTasks(newTasks);
        if (activeTab === tab) setActiveTab(newTabs[0]);
        setDeletingTab(null);
      };

      const renameTab = (oldName, newName) => {
        if (!newName.trim() || newName === oldName) { setEditingTab(null); return; }
        const newTabs = tabs.map(t => t === oldName ? newName : t);
        const newTasks = { ...tasks, [newName]: tasks[oldName] };
        delete newTasks[oldName];
        setTabs(newTabs);
        setTasks(newTasks);
        if (activeTab === oldName) setActiveTab(newName);
        setEditingTab(null);
      };

      const handleDragStart = (e, tab) => { setDraggedTab(tab); e.dataTransfer.effectAllowed = 'move'; };
      const handleDragOver = (e, tab) => { e.preventDefault(); if (draggedTab && draggedTab !== tab) e.currentTarget.classList.add('drag-over'); };
      const handleDragLeave = (e) => { e.currentTarget.classList.remove('drag-over'); };
      const handleDrop = (e, targetTab) => {
        e.preventDefault();
        e.currentTarget.classList.remove('drag-over');
        if (!draggedTab || draggedTab === targetTab) return;
        const newTabs = [...tabs];
        const draggedIndex = newTabs.indexOf(draggedTab);
        const targetIndex = newTabs.indexOf(targetTab);
        newTabs.splice(draggedIndex, 1);
        newTabs.splice(targetIndex, 0, draggedTab);
        setTabs(newTabs);
        setDraggedTab(null);
      };
      const handleDragEnd = () => { setDraggedTab(null); };

      const addTask = () => {
        const newTask = { id: Date.now(), title: '', status: 'pending', priority: 'medium', due: new Date().toISOString().split('T')[0], details: '', subtasks: [] };
        setTasks({ ...tasks, [activeTab]: [...tasks[activeTab], newTask] });
        setExpandedRows(new Set([...expandedRows, newTask.id]));
      };

      const updateTask = (id, field, value) => { setTasks({ ...tasks, [activeTab]: tasks[activeTab].map(t => t.id === id ? { ...t, [field]: value } : t) }); };
      const deleteTask = (id) => {
        const task = tasks[activeTab].find(t => t.id === id);
        if (task) pushUndo({ type: 'deleteTask', category: activeTab, task });
        setTasks({ ...tasks, [activeTab]: tasks[activeTab].filter(t => t.id !== id) });
      };

      const addSubtask = (taskId) => {
        const newSubtask = { id: Date.now(), title: '', done: false };
        setTasks({ ...tasks, [activeTab]: tasks[activeTab].map(t => t.id === taskId ? { ...t, subtasks: [...(t.subtasks || []), newSubtask] } : t) });
      };
      const updateSubtask = (taskId, subtaskId, field, value) => { setTasks({ ...tasks, [activeTab]: tasks[activeTab].map(t => t.id === taskId ? { ...t, subtasks: (t.subtasks || []).map(st => st.id === subtaskId ? { ...st, [field]: value } : st) } : t) }); };
      const deleteSubtask = (taskId, subtaskId) => {
        const task = tasks[activeTab].find(t => t.id === taskId);
        const subtask = task?.subtasks?.find(st => st.id === subtaskId);
        if (subtask) pushUndo({ type: 'deleteSubtask', category: activeTab, taskId, subtask });
        setTasks({ ...tasks, [activeTab]: tasks[activeTab].map(t => t.id === taskId ? { ...t, subtasks: (t.subtasks || []).filter(st => st.id !== subtaskId) } : t) });
      };

      const getSubtaskProgress = (task) => {
        const subtasks = task.subtasks || [];
        if (subtasks.length === 0) return null;
        return { done: subtasks.filter(st => st.done).length, total: subtasks.length };
      };

      const getAllTasksByPriority = () => {
        const allTasks = [];
        tabs.forEach(tab => { (tasks[tab] || []).forEach(task => allTasks.push({ ...task, category: tab })); });
        return { high: allTasks.filter(t => t.priority === 'high'), medium: allTasks.filter(t => t.priority === 'medium'), low: allTasks.filter(t => t.priority === 'low') };
      };

      const updateTaskInCategory = (category, taskId, field, value) => { setTasks({ ...tasks, [category]: tasks[category].map(t => t.id === taskId ? { ...t, [field]: value } : t) }); };
      const deleteTaskInCategory = (category, taskId) => {
        const task = tasks[category].find(t => t.id === taskId);
        if (task) pushUndo({ type: 'deleteTask', category, task });
        setTasks({ ...tasks, [category]: tasks[category].filter(t => t.id !== taskId) });
      };
      const addSubtaskInCategory = (category, taskId) => {
        const newSubtask = { id: Date.now(), title: '', done: false };
        setTasks({ ...tasks, [category]: tasks[category].map(t => t.id === taskId ? { ...t, subtasks: [...(t.subtasks || []), newSubtask] } : t) });
      };
      const updateSubtaskInCategory = (category, taskId, subtaskId, field, value) => { setTasks({ ...tasks, [category]: tasks[category].map(t => t.id === taskId ? { ...t, subtasks: (t.subtasks || []).map(st => st.id === subtaskId ? { ...st, [field]: value } : st) } : t) }); };
      const deleteSubtaskInCategory = (category, taskId, subtaskId) => {
        const task = tasks[category].find(t => t.id === taskId);
        const subtask = task?.subtasks?.find(st => st.id === subtaskId);
        if (subtask) pushUndo({ type: 'deleteSubtask', category, taskId, subtask });
        setTasks({ ...tasks, [category]: tasks[category].map(t => t.id === taskId ? { ...t, subtasks: (t.subtasks || []).filter(st => st.id !== subtaskId) } : t) });
      };

      const downloadSave = () => {
        const data = JSON.stringify({ tabs, tasks }, null, 2);
        const blob = new Blob([data], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `worklist_${new Date().toISOString().split('T')[0]}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      };

      const handleFileUpload = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const data = JSON.parse(event.target.result);
            if (data.tabs && data.tasks) {
              setTabs(data.tabs);
              setTasks(data.tasks);
              setActiveTab(data.tabs[0]);
              setExpandedRows(new Set());
              localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            }
          } catch (err) {}
        };
        reader.readAsText(file);
        e.target.value = '';
      };

      const shareToSlack = async (category, options = {}) => {
        if (!settings.slackWebhook) { setShowSlackModal(true); return; }
        const categoryTasks = tasks[category] || [];
        const activeTasks = categoryTasks.filter(t => t.status !== 'done');
        const completedTasks = categoryTasks.filter(t => t.status === 'done');
        const priorityEmoji = { high: 'üî¥', medium: 'üü°', low: '‚ö™' };
        let blocks = [{ type: 'header', text: { type: 'plain_text', text: `üìã Worklist: ${category}`, emoji: true } }];
        ['high', 'medium', 'low'].forEach(priority => {
          const prioTasks = activeTasks.filter(t => t.priority === priority);
          if (prioTasks.length > 0) {
            const label = priority.charAt(0).toUpperCase() + priority.slice(1);
            let text = `*${priorityEmoji[priority]} ${label} Priority*\n`;
            prioTasks.forEach(t => { text += `‚Ä¢ ${t.title || '(untitled)'}${t.due ? ` ‚Äî Due: ${t.due}` : ''}\n`; });
            blocks.push({ type: 'section', text: { type: 'mrkdwn', text } });
          }
        });
        if (options.includeCompleted && completedTasks.length > 0) {
          let text = `*‚úÖ Completed*\n`;
          completedTasks.forEach(t => { text += `‚Ä¢ ~${t.title || '(untitled)'}~\n`; });
          blocks.push({ type: 'section', text: { type: 'mrkdwn', text } });
        }
        blocks.push({ type: 'context', elements: [{ type: 'mrkdwn', text: `${activeTasks.length} active ‚Ä¢ ${completedTasks.length} complete ‚Ä¢ Updated just now` }] });
        setSlackStatus('sending');
        try {
          await fetch(settings.slackWebhook, { method: 'POST', body: JSON.stringify({ blocks }) });
          setSlackStatus('success');
          setTimeout(() => { setSlackStatus(null); setShowShareModal(false); }, 2000);
        } catch (err) { setSlackStatus('error'); }
      };

      const isPriorityView = activeTab === '‚ö° Priority';
      const currentTasks = tasks[activeTab] || [];
      const activeTasks = currentTasks.filter(t => t.status !== 'done');
      const doneTasks = currentTasks.filter(t => t.status === 'done');

      const renderTaskRow = (task, isDone = false, forCategory = null) => {
        const isExpanded = expandedRows.has(task.id);
        const progress = getSubtaskProgress(task);
        const category = forCategory || activeTab;
        const updateFn = forCategory ? (id, f, v) => updateTaskInCategory(category, id, f, v) : updateTask;
        const deleteFn = forCategory ? (id) => deleteTaskInCategory(category, id) : deleteTask;
        const addSubFn = forCategory ? (id) => addSubtaskInCategory(category, id) : addSubtask;
        const updateSubFn = forCategory ? (tid, sid, f, v) => updateSubtaskInCategory(category, tid, sid, f, v) : updateSubtask;
        const deleteSubFn = forCategory ? (tid, sid) => deleteSubtaskInCategory(category, tid, sid) : deleteSubtask;
        
        // Status-based class for row coloring
        const statusClass = `status-${task.status}`;
        const currentTasks = tasks[activeTab] || [];
        const taskIndex = currentTasks.findIndex(t => t.id === task.id);
        const isFocused = taskIndex === focusedTaskIndex;

        return (
          <React.Fragment key={task.id}>
            <tr className={`task-row ${statusClass} ${isFocused ? 'focused' : ''}`}>
              <td style={{width: '50px', textAlign: 'center'}}>
                <button className="expand-btn" onClick={() => toggleRow(task.id)}>
                  {isExpanded ? <ChevronDown /> : <ChevronRight />}
                </button>
              </td>
              <td>
                <div className="task-title-cell">
                  <input className={`task-input ${isDone ? 'done' : ''}`} value={task.title} placeholder="Enter task..." onChange={(e) => updateFn(task.id, 'title', e.target.value)} />
                  {progress && <span className="subtask-badge">{progress.done}/{progress.total}</span>}
                </div>
              </td>
              {forCategory && <td><span className="category-badge">{category}</span></td>}
              <td style={{width: '130px'}}>
                <select className={`status-select status-${task.status}`} value={task.status} onChange={(e) => updateFn(task.id, 'status', e.target.value)}>
                  <option value="pending">Pending</option>
                  <option value="in-progress">Active</option>
                  <option value="done">Complete</option>
                </select>
              </td>
              {!forCategory && (
                <td style={{width: '110px'}}>
                  <div className="priority-cell">
                    <span className={`priority-dot ${task.priority}`}></span>
                    <select className="priority-select" value={task.priority} onChange={(e) => updateFn(task.id, 'priority', e.target.value)}>
                      <option value="low">Low</option>
                      <option value="medium">Medium</option>
                      <option value="high">High</option>
                    </select>
                  </div>
                </td>
              )}
              <td style={{width: '140px'}}>
                <input type="date" className="date-input" value={task.due} onChange={(e) => updateFn(task.id, 'due', e.target.value)} />
                {getDueDateBadge(task)}
              </td>
              <td style={{width: '50px', textAlign: 'center'}}>
                <button className="delete-btn" onClick={() => deleteFn(task.id)}><X /></button>
              </td>
            </tr>
            {isExpanded && (
              <tr className="expanded-row">
                <td></td>
                <td colSpan={forCategory ? 5 : 5}>
                  <div className="expanded-content">
                    <div className="subtask-header">
                      <button className="add-subtask-btn" onClick={() => addSubFn(task.id)}><Plus /> Add subtask</button>
                      <span className="subtask-label">Subtasks</span>
                    </div>
                    {(task.subtasks || []).length === 0 ? (
                      <div className="no-subtasks">No subtasks yet</div>
                    ) : (
                      <div className="subtask-list">
                        {(task.subtasks || []).map((st) => (
                          <div key={st.id} className="subtask-item">
                            <input type="checkbox" className="subtask-checkbox" checked={st.done} onChange={(e) => updateSubFn(task.id, st.id, 'done', e.target.checked)} />
                            <input className={`subtask-input ${st.done ? 'done' : ''}`} value={st.title} placeholder="Enter subtask..." onChange={(e) => updateSubFn(task.id, st.id, 'title', e.target.value)} />
                            <button className="subtask-delete" onClick={() => deleteSubFn(task.id, st.id)}><X /></button>
                          </div>
                        ))}
                      </div>
                    )}
                    <div className="notes-label">Notes</div>
                    <textarea className="notes-input" value={task.details} placeholder="Add notes..." onChange={(e) => updateFn(task.id, 'details', e.target.value)} rows={3} />
                  </div>
                </td>
              </tr>
            )}
          </React.Fragment>
        );
      };

      const renderEmptyState = (message, showAdd = false) => (
        <div className="empty-state">
          <div className="empty-icon"><ClipboardIcon /></div>
          <p className="empty-text">{message}</p>
          {showAdd && <button className="btn btn-primary" onClick={addTask}><Plus /> Add your first task</button>}
        </div>
      );

      const renderPriorityContent = () => {
        const allTasks = Object.values(getAllTasksByPriority()).flat();
        if (allTasks.length === 0) return renderEmptyState("No tasks yet. Create tasks in your categories to see them organized by priority.");
        const priorityLabels = { high: 'High Priority', medium: 'Medium Priority', low: 'Low Priority' };
        return (
          <div>
            {['high', 'medium', 'low'].map(priority => {
              const prioTasks = getAllTasksByPriority()[priority].filter(t => t.status !== 'done');
              return (
                <div key={priority} className={`priority-section ${priority}`}>
                  <div className="section-header">
                    <div className="section-title" style={{display: 'flex', alignItems: 'center', gap: '10px'}}>
                      <span className={`priority-dot ${priority}`}></span>
                      {priorityLabels[priority]}
                    </div>
                    <span className="section-count">{prioTasks.length}</span>
                  </div>
                  {prioTasks.length === 0 ? (
                    <div style={{padding: '32px', textAlign: 'center', color: 'var(--text-muted)', fontSize: '14px'}}>No {priority} priority tasks</div>
                  ) : (
                    <table className="task-table">
                      <thead>
                        <tr>
                          <th style={{width: '50px'}}></th>
                          <th>Task</th>
                          <th>Category</th>
                          <th>Status</th>
                          <th>Due</th>
                          <th style={{width: '50px'}}></th>
                        </tr>
                      </thead>
                      <tbody>{prioTasks.map(task => renderTaskRow(task, false, task.category))}</tbody>
                    </table>
                  )}
                </div>
              );
            })}
            {(() => {
              const allDone = Object.values(getAllTasksByPriority()).flat().filter(t => t.status === 'done');
              if (allDone.length === 0) return null;
              return (
                <div className="priority-section complete">
                  <div className="section-header">
                    <span className="section-title">‚úì Complete</span>
                    <span className="section-count">{allDone.length}</span>
                  </div>
                  <table className="task-table">
                    <thead><tr><th style={{width: '50px'}}></th><th>Task</th><th>Category</th><th>Status</th><th>Due</th><th style={{width: '50px'}}></th></tr></thead>
                    <tbody>{allDone.map(task => renderTaskRow(task, true, task.category))}</tbody>
                  </table>
                </div>
              );
            })()}
          </div>
        );
      };

      const renderTabContent = () => {
        if (currentTasks.length === 0) return renderEmptyState("No tasks in this category yet.", true);
        return (
          <div>
            <div className="task-section">
              <div className="section-header">
                <span className="section-title">Active</span>
                <span className="section-count">{activeTasks.length}</span>
              </div>
              {activeTasks.length === 0 ? (
                <div style={{padding: '32px', textAlign: 'center', color: 'var(--text-muted)', fontSize: '14px'}}>No active tasks</div>
              ) : (
                <table className="task-table">
                  <thead><tr><th style={{width: '50px'}}></th><th>Task</th><th>Status</th><th>Priority</th><th>Due</th><th style={{width: '50px'}}></th></tr></thead>
                  <tbody>{activeTasks.map(t => renderTaskRow(t, false))}</tbody>
                </table>
              )}
            </div>
            {doneTasks.length > 0 && (
              <div className="task-section done">
                <div className="section-header">
                  <span className="section-title">‚úì Complete</span>
                  <span className="section-count">{doneTasks.length}</span>
                </div>
                <table className="task-table">
                  <thead><tr><th style={{width: '50px'}}></th><th>Task</th><th>Status</th><th>Priority</th><th>Due</th><th style={{width: '50px'}}></th></tr></thead>
                  <tbody>{doneTasks.map(t => renderTaskRow(t, true))}</tbody>
                </table>
              </div>
            )}
          </div>
        );
      };

      return (
        <div className="app-container">
          <div className="sidebar">
            <div className="sidebar-header">
              <Logo />
              <span>Worklist</span>
            </div>
            <div className="sidebar-content">
              <div className="sidebar-section-title">Categories</div>
              {tabs.map(tab => (
                <div key={tab} className={`tab-item ${activeTab === tab ? 'active' : ''}`} draggable onDragStart={(e) => handleDragStart(e, tab)} onDragOver={(e) => handleDragOver(e, tab)} onDragLeave={handleDragLeave} onDrop={(e) => handleDrop(e, tab)} onDragEnd={handleDragEnd} onClick={() => setActiveTab(tab)} onDoubleClick={() => setEditingTab(tab)}>
                  {editingTab === tab ? (
                    <input className="tab-input" autoFocus defaultValue={tab} onBlur={(e) => renameTab(tab, e.target.value)} onKeyDown={(e) => { if (e.key === 'Enter') renameTab(tab, e.target.value); if (e.key === 'Escape') setEditingTab(null); }} onClick={(e) => e.stopPropagation()} />
                  ) : (
                    <>
                      <span className="tab-name"><span className="grip"><GripIcon /></span>{tab}</span>
                      <div style={{display: 'flex', alignItems: 'center', gap: '6px'}}>
                        <span className="tab-count">{(tasks[tab] || []).length}</span>
                        {tabs.length > 1 && <button className="tab-close" onClick={(e) => { e.stopPropagation(); setDeletingTab(tab); }}><X /></button>}
                      </div>
                    </>
                  )}
                </div>
              ))}
              <button className="add-category" onClick={addTab}><Plus /> Add category</button>
            </div>
            <div style={{padding: '8px 12px', borderTop: '1px solid rgba(255,255,255,0.1)'}}>
              <div className={`priority-tab ${isPriorityView ? 'active' : ''}`} onClick={() => setActiveTab('‚ö° Priority')}>‚ö° All by Priority</div>
            </div>
            <div className="sidebar-footer">
              <div className="sync-status">
                <span className={`sync-dot ${saveStatus === 'saving' ? 'saving' : 'saved'}`}></span>
                <span style={{fontFamily: 'monospace'}}>{saveStatus === 'saving' ? 'Saving...' : 'Saved'}</span>
              </div>
              <div className="sidebar-buttons">
                <button className="sidebar-btn" onClick={downloadSave}><Download /> Export</button>
                <button className="sidebar-btn" onClick={() => fileInputRef.current?.click()}><Upload /> Import</button>
              </div>
              <button className="sidebar-btn full" onClick={() => setShowSlackModal(true)}><SlackIcon /> {settings.slackWebhook ? 'Slack Connected' : 'Connect Slack'}</button>
              <button className="theme-toggle" onClick={toggleTheme}>
                {settings.theme === 'light' ? <><MoonIcon /> Dark Mode</> : <><SunIcon /> Light Mode</>}
              </button>
              <input type="file" ref={fileInputRef} onChange={handleFileUpload} accept=".json" className="hidden" />
            </div>
          </div>

          <div className="main-content">
            <div className="main-header">
              <h1>{isPriorityView ? '‚ö° All Tasks by Priority' : activeTab}</h1>
              <div className="header-buttons">
                {!isPriorityView && settings.slackWebhook && <button className="btn btn-secondary" onClick={() => { setShareCategory(activeTab); setShowShareModal(true); }}><SlackIcon /> Share</button>}
                {!isPriorityView && <button className="btn btn-primary" onClick={addTask} title="Ctrl+K / Cmd+K"><Plus /> Add Task</button>}
              </div>
            </div>
            <div className="main-body">
              {isPriorityView ? renderPriorityContent() : renderTabContent()}
            </div>
          </div>

          {deletingTab && (
            <div className="modal-overlay" onClick={() => setDeletingTab(null)}>
              <div className="modal" onClick={(e) => e.stopPropagation()}>
                <div className="modal-title">Delete "{deletingTab}"?</div>
                <p className="modal-text">This will permanently delete {(tasks[deletingTab] || []).length} task{(tasks[deletingTab] || []).length !== 1 ? 's' : ''}. This action cannot be undone.</p>
                <div className="modal-buttons">
                  <button className="btn btn-secondary" onClick={() => setDeletingTab(null)}>Cancel</button>
                  <button className="btn btn-danger" onClick={() => closeTab(deletingTab)}>Delete</button>
                </div>
              </div>
            </div>
          )}

          {showSlackModal && (
            <div className="modal-overlay" onClick={() => setShowSlackModal(false)}>
              <div className="modal" onClick={(e) => e.stopPropagation()}>
                <div className="modal-title"><SlackIcon /> Slack Integration</div>
                <p className="modal-text">Connect Worklist to share tasks directly to your Slack channels.</p>
                <label className="modal-label">Webhook URL</label>
                <input className="modal-input" type="text" value={settings.slackWebhook} onChange={(e) => setSettings({ ...settings, slackWebhook: e.target.value })} placeholder="https://hooks.slack.com/services/..." />
                <div className="modal-help">
                  <div className="modal-help-title">How to get a Webhook URL:</div>
                  <ol>
                    <li>Go to api.slack.com/apps</li>
                    <li>Create New App ‚Üí From Scratch</li>
                    <li>Add "Incoming Webhooks" feature</li>
                    <li>Create webhook for your channel</li>
                    <li>Copy the URL and paste above</li>
                  </ol>
                </div>
                <div className="modal-buttons">
                  <button className="btn btn-secondary" onClick={() => setShowSlackModal(false)}>Cancel</button>
                  <button className="btn btn-primary" onClick={() => setShowSlackModal(false)} disabled={!settings.slackWebhook}>Save</button>
                </div>
              </div>
            </div>
          )}

          {showShareModal && shareCategory && (
            <div className="modal-overlay" onClick={() => setShowShareModal(false)}>
              <div className="modal" onClick={(e) => e.stopPropagation()}>
                <div className="modal-title"><ShareIcon /> Share to Slack</div>
                <p className="modal-text">Post {(tasks[shareCategory] || []).filter(t => t.status !== 'done').length} active task{(tasks[shareCategory] || []).filter(t => t.status !== 'done').length !== 1 ? 's' : ''} from "{shareCategory}" to Slack?</p>
                <label className="checkbox-label"><input type="checkbox" id="includeCompleted" /> Include completed tasks</label>
                {slackStatus === 'error' && <div className="alert alert-error">Failed to send. Please check your webhook URL.</div>}
                {slackStatus === 'success' && <div className="alert alert-success">‚úì Successfully posted to Slack!</div>}
                <div className="modal-buttons">
                  <button className="btn btn-secondary" onClick={() => { setShowShareModal(false); setSlackStatus(null); }}>Cancel</button>
                  <button className="btn btn-primary" onClick={() => shareToSlack(shareCategory, { includeCompleted: document.getElementById('includeCompleted')?.checked })} disabled={slackStatus === 'sending'}>{slackStatus === 'sending' ? 'Sending...' : <><SlackIcon /> Post to Slack</>}</button>
                </div>
              </div>
            </div>
          )}

          {showUndo && undoStack.length > 0 && (
            <div className="undo-toast">
              <span>{undoStack[0].type === 'deleteTask' ? 'Task deleted' : 'Subtask deleted'}</span>
              <button className="undo-btn" onClick={performUndo}><UndoIcon /> Undo</button>
              <button className="undo-close" onClick={() => { setShowUndo(false); setUndoStack([]); }}><X /></button>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<Worklist />, document.getElementById('root'));
  </script>
</body>
</html>
